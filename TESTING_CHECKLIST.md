# ModernFS æµ‹è¯•æ¸…å•

æœ¬æ–‡æ¡£æä¾›äº†ä¸€ä¸ªç®€æ˜çš„æ¸…å•ï¼Œç”¨äºéªŒè¯ ModernFS æ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰æµ‹è¯•æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

## âœ… å¿«é€ŸéªŒè¯æ¸…å•

### 1. ç¯å¢ƒæ£€æŸ¥

- [ ] Rust å·¥å…·é“¾å·²å®‰è£…
  ```bash
  rustc --version
  cargo --version
  ```

- [ ] C ç¼–è¯‘å™¨å·²å®‰è£…
  ```bash
  gcc --version
  cmake --version
  ```

- [ ] é¡¹ç›®å·²å…‹éš†/ä¸‹è½½

---

### 2. æ„å»ºéªŒè¯

- [ ] Rust åº“ç¼–è¯‘æˆåŠŸ
  ```bash
  cargo build --release
  # åº”è¯¥çœ‹åˆ°: Finished `release` profile [optimized]
  ```

- [ ] C ä»£ç ç¼–è¯‘æˆåŠŸ
  ```bash
  ./build.sh
  # æˆ–è€…
  mkdir -p build && cd build && cmake .. && make -j4
  ```

- [ ] æ‰€æœ‰æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶å­˜åœ¨
  ```bash
  ls -1 build/test_*
  # åº”è¯¥åˆ—å‡º 13 ä¸ªæµ‹è¯•æ–‡ä»¶
  ```

---

### 3. åŸºç¡€æµ‹è¯•éªŒè¯

#### 3.1 FFI æ¥å£æµ‹è¯•

- [ ] è¿è¡Œæµ‹è¯•
  ```bash
  ./build/test_ffi
  ```

- [ ] é¢„æœŸè¾“å‡ºåŒ…å«
  - `Hello from Rust!`
  - `âœ… All FFI tests passed!`

---

#### 3.2 å—è®¾å¤‡å±‚æµ‹è¯•

- [ ] è¿è¡Œæµ‹è¯•
  ```bash
  ./build/test_block_layer
  ```

- [ ] é¢„æœŸè¾“å‡ºåŒ…å«
  - `âœ… Block device test passed`
  - `âœ… Buffer cache test passed`
  - `âœ… Block allocator test passed`
  - `âœ… All Tests Passed!`

---

#### 3.3 Inode å±‚æµ‹è¯•

- [ ] è¿è¡Œæµ‹è¯•
  ```bash
  ./build/test_inode_layer
  ```

- [ ] é¢„æœŸè¾“å‡ºåŒ…å«
  - `âœ… æµ‹è¯•1é€šè¿‡` (Inode åˆ†é…å’Œé‡Šæ”¾)
  - `âœ… æµ‹è¯•2é€šè¿‡` (Inode è¯»å†™)
  - `âœ… æµ‹è¯•3é€šè¿‡` (ç›®å½•æ“ä½œ)
  - `âœ… æµ‹è¯•4é€šè¿‡` (è·¯å¾„æ“ä½œ)
  - `âœ… æµ‹è¯•5é€šè¿‡` (æ•°æ®å—æ˜ å°„)

---

### 4. Rust ç»„ä»¶æµ‹è¯•éªŒè¯

#### 4.1 Journal Manager æµ‹è¯•

- [ ] è¿è¡Œæµ‹è¯•
  ```bash
  ./build/test_journal
  ```

- [ ] é¢„æœŸè¾“å‡ºåŒ…å«
  - `âœ… Journal Manageråˆå§‹åŒ–æˆåŠŸ`
  - `âœ… äº‹åŠ¡å·²æäº¤`
  - `âœ… Checkpointæ‰§è¡ŒæˆåŠŸ`
  - `âœ… æ¢å¤äº† X ä¸ªäº‹åŠ¡` (æˆ– è­¦å‘Šæœªæ¢å¤åˆ°äº‹åŠ¡)
  - `æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ âœ…`

---

#### 4.2 Extent Allocator æµ‹è¯•

- [ ] è¿è¡Œæµ‹è¯•
  ```bash
  ./build/test_extent
  ```

- [ ] é¢„æœŸè¾“å‡ºåŒ…å«
  - `âœ… Extent Allocator åˆå§‹åŒ–æˆåŠŸ`
  - `âœ… åˆ†é…æˆåŠŸ`
  - `âœ… é‡Šæ”¾æˆåŠŸ`
  - `âœ… Double-free è¢«æ­£ç¡®æ£€æµ‹å¹¶æ‹’ç»`
  - `æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ âœ…`

---

### 5. é›†æˆæµ‹è¯•éªŒè¯

#### 5.1 Week 7 é›†æˆæµ‹è¯•

- [ ] è¿è¡Œæµ‹è¯•
  ```bash
  ./build/test_week7_integration
  ```

- [ ] é¢„æœŸè¾“å‡ºåŒ…å«
  - `âœ“ fs_contextåˆå§‹åŒ–æˆåŠŸ`
  - `âœ“ Journal Managerå·²åˆå§‹åŒ–`
  - `âœ“ Extent Allocatorå·²åˆå§‹åŒ–`
  - `âœ“ Checkpointçº¿ç¨‹å·²å¯åŠ¨`
  - `æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ âœ…`

---

### 6. æ–°å¢å…¨é¢æµ‹è¯•éªŒè¯ â­

#### 6.1 å®Œæ•´è¦†ç›–æµ‹è¯•

- [ ] è¿è¡Œæµ‹è¯•
  ```bash
  ./build/test_full_coverage
  ```

- [ ] é¢„æœŸè¾“å‡ºåŒ…å«
  - `æµ‹è¯•1ï¼šå®Œæ•´æ–‡ä»¶ç³»ç»Ÿåˆå§‹åŒ–` âœ…
  - `æµ‹è¯•2ï¼šæ–‡ä»¶åŸºæœ¬æ“ä½œ` âœ…
  - `æµ‹è¯•3ï¼šç›®å½•æ“ä½œ` âœ…
  - `æµ‹è¯•4ï¼šè¾¹ç•Œæ¡ä»¶` âœ…
  - `æµ‹è¯•5ï¼šRust/Cé›†æˆ` âœ…
  - `æµ‹è¯•6ï¼šè·¯å¾„è§£æ` âœ…
  - `æµ‹è¯•7ï¼šå´©æºƒä¸€è‡´æ€§` âœ…
  - `ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼(7/7)`

---

#### 6.2 é”™è¯¯å¤„ç†æµ‹è¯•

- [ ] è¿è¡Œæµ‹è¯•
  ```bash
  ./build/test_error_handling
  ```

- [ ] é¢„æœŸè¾“å‡ºåŒ…å«
  - `æµ‹è¯•1ï¼šç£ç›˜ç©ºé—´è€—å°½` âœ…
  - `æµ‹è¯•2ï¼šæ— æ•ˆå‚æ•°æ£€æµ‹` âœ…
  - `æµ‹è¯•3ï¼šDouble-Freeæ£€æµ‹` âœ…
  - `æµ‹è¯•4ï¼šé‡å¤æ–‡ä»¶åæ£€æµ‹` âœ…
  - `æµ‹è¯•5ï¼šè¯»å–ä¸å­˜åœ¨çš„æ–‡ä»¶` âœ…
  - `æµ‹è¯•6ï¼šåˆ é™¤ä¸å­˜åœ¨çš„æ–‡ä»¶` âœ…
  - `æµ‹è¯•7ï¼šExtentè¾¹ç•Œæ£€æŸ¥` âœ…
  - `æµ‹è¯•8ï¼šJournalå›æ»š` âœ…
  - `ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼(8/8)`

---

#### 6.3 å‹åŠ›æµ‹è¯•

- [ ] è¿è¡Œæµ‹è¯•
  ```bash
  ./build/test_stress
  ```

- [ ] é¢„æœŸè¾“å‡ºåŒ…å«
  - `æµ‹è¯•1ï¼šå¤§é‡å°æ–‡ä»¶åˆ›å»º` âœ…
  - `æµ‹è¯•2ï¼šå¤§æ–‡ä»¶é¡ºåºå†™å…¥` âœ…
  - `æµ‹è¯•3ï¼šå¤§æ–‡ä»¶é¡ºåºè¯»å–` âœ…
  - `æµ‹è¯•4ï¼šéšæœºè¯»å†™` âœ…
  - `æµ‹è¯•5ï¼šæ·±å±‚ç›®å½•ç»“æ„` âœ…
  - `æµ‹è¯•6ï¼šç¢ç‰‡åŒ–åœºæ™¯` âœ…
  - `ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼(6/6)`

- [ ] æ€§èƒ½æŒ‡æ ‡åˆç†
  - å°æ–‡ä»¶åˆ›å»ºé€Ÿåº¦ > 50 æ–‡ä»¶/ç§’
  - éšæœº IOPS > 100
  - æ²¡æœ‰å´©æºƒæˆ–æŒ‚èµ·

---

### 7. å®Œæ•´æµ‹è¯•å¥—ä»¶éªŒè¯ â­â­â­

#### 7.1 è¿è¡Œä¸€é”®æµ‹è¯•è„šæœ¬

- [ ] ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
  ```bash
  chmod +x run_full_test_suite.sh
  ```

- [ ] è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
  ```bash
  ./run_full_test_suite.sh
  ```

- [ ] é¢„æœŸè¾“å‡ºåŒ…å«
  - `æ­¥éª¤1: æ£€æŸ¥æ„å»ºç³»ç»Ÿ` âœ“
  - `æ­¥éª¤2: ç¼–è¯‘Rustæ ¸å¿ƒåº“` âœ“
  - `æ­¥éª¤3: ç¼–è¯‘Cä»£ç å’Œæµ‹è¯•` âœ“
  - `æ­¥éª¤4: è¿è¡Œæµ‹è¯•å¥—ä»¶`
  - æ‰€æœ‰æµ‹è¯•æ˜¾ç¤º `âœ… é€šè¿‡`

- [ ] æœ€ç»ˆç»“æœ
  ```
  æ€»æµ‹è¯•æ•°:   10
  é€šè¿‡:       10
  å¤±è´¥:       0
  
  ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ–‡ä»¶ç³»ç»ŸåŠŸèƒ½å®Œæ•´ï¼
  ```

---

### 8. Rust å•å…ƒæµ‹è¯•éªŒè¯

- [ ] è¿è¡Œ Rust å•å…ƒæµ‹è¯•
  ```bash
  cargo test --manifest-path rust_core/Cargo.toml --release
  ```

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
  - æ²¡æœ‰ `FAILED` è¾“å‡º
  - çœ‹åˆ° `test result: ok`

---

### 9. æ–‡æ¡£éªŒè¯

- [ ] æ–‡æ¡£æ–‡ä»¶å­˜åœ¨ä¸”å†…å®¹æ­£ç¡®
  - [ ] `COMPREHENSIVE_TESTS.md`
  - [ ] `tests/README.md`
  - [ ] `NEW_TESTS_SUMMARY.md`
  - [ ] `TESTING_CHECKLIST.md` (æœ¬æ–‡ä»¶)

- [ ] README.md å·²æ›´æ–°
  - [ ] åŒ…å« "å®Œæ•´æµ‹è¯•å¥—ä»¶" ç« èŠ‚
  - [ ] æåˆ° `run_full_test_suite.sh`

---

### 10. ä»£ç è´¨é‡æ£€æŸ¥

- [ ] C ä»£ç ç¼–è¯‘æ— é”™è¯¯
  ```bash
  cd build && make 2>&1 | grep -i error
  # åº”è¯¥æ²¡æœ‰è¾“å‡ºï¼ˆæˆ–åªæœ‰é¢„æœŸçš„è­¦å‘Šï¼‰
  ```

- [ ] Rust ä»£ç  lint é€šè¿‡
  ```bash
  cargo clippy --manifest-path rust_core/Cargo.toml --release
  # åº”è¯¥æ²¡æœ‰ä¸¥é‡è­¦å‘Š
  ```

- [ ] Rust ä»£ç æ ¼å¼æ­£ç¡®
  ```bash
  cargo fmt --manifest-path rust_core/Cargo.toml --check
  # åº”è¯¥æ²¡æœ‰æ ¼å¼é—®é¢˜
  ```

---

## ğŸ¯ å®Œæ•´éªŒè¯æµç¨‹ï¼ˆæ¨èï¼‰

æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œå®Œæ•´éªŒè¯ï¼š

### æ­¥éª¤ 1: ç¯å¢ƒå‡†å¤‡

```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
cd /path/to/ModernFS

# æ£€æŸ¥ Rust
rustc --version
cargo --version

# æ£€æŸ¥ C ç¼–è¯‘å™¨
gcc --version
cmake --version
```

### æ­¥éª¤ 2: æ¸…ç†å¹¶é‡æ–°æ„å»º

```bash
# æ¸…ç†æ—§çš„æ„å»º
rm -rf build target

# é‡æ–°æ„å»º
./build.sh

# éªŒè¯æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶
ls -l build/test_* | wc -l
# åº”è¯¥è¾“å‡º: 13
```

### æ­¥éª¤ 3: è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
# è¿™æ˜¯æœ€é‡è¦çš„ä¸€æ­¥
chmod +x run_full_test_suite.sh
./run_full_test_suite.sh
```

### æ­¥éª¤ 4: æ£€æŸ¥ç»“æœ

- âœ… å¦‚æœçœ‹åˆ° "ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼" - å®Œç¾ï¼
- âš ï¸ å¦‚æœæœ‰å¤±è´¥ - æŸ¥çœ‹é”™è¯¯ä¿¡æ¯å¹¶å‚è€ƒæ•…éšœæ’æŸ¥éƒ¨åˆ†

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: Rust åº“é“¾æ¥å¤±è´¥

**ç—‡çŠ¶**: `cannot find -lrust_core`

**è§£å†³æ–¹æ³•**:
```bash
cargo build --release
rm -rf build
./build.sh
```

---

### é—®é¢˜ 2: mkfs.modernfs ä¸å­˜åœ¨

**ç—‡çŠ¶**: æµ‹è¯•æç¤º "mkfs.modernfs not found"

**è§£å†³æ–¹æ³•**:
```bash
cd build
make mkfs.modernfs
cd ..
```

---

### é—®é¢˜ 3: æµ‹è¯•æŒ‚èµ·æˆ–è¶…æ—¶

**ç—‡çŠ¶**: æµ‹è¯•é•¿æ—¶é—´æ— å“åº”

**å¯èƒ½åŸå› **:
- Checkpoint çº¿ç¨‹æ­»é”
- ç£ç›˜ I/O é—®é¢˜
- æ— é™å¾ªç¯

**è§£å†³æ–¹æ³•**:
```bash
# å¼ºåˆ¶åœæ­¢
Ctrl+C

# æ¸…ç†æµ‹è¯•æ–‡ä»¶
rm -f test_*.img

# é‡æ–°è¿è¡Œ
./build/test_name
```

---

### é—®é¢˜ 4: æƒé™é”™è¯¯

**ç—‡çŠ¶**: "Permission denied"

**è§£å†³æ–¹æ³•**:
```bash
chmod +x run_full_test_suite.sh
chmod +x build/test_*
```

---

### é—®é¢˜ 5: ç¼–è¯‘è­¦å‘Šè¿‡å¤š

**ç—‡çŠ¶**: å¤§é‡æœªä½¿ç”¨å˜é‡è­¦å‘Š

**æ³¨æ„**: è¿™äº›è­¦å‘Šé€šå¸¸æ˜¯å®‰å…¨çš„ï¼Œä½†å¦‚æœæƒ³ä¿®å¤ï¼š
```bash
# æŸ¥æ‰¾æœªä½¿ç”¨çš„å˜é‡
grep -r "warning: unused variable" build/
```

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç»Ÿè®¡

è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶åï¼Œåº”è¯¥è¦†ç›–ï¼š

### C ç»„ä»¶
- âœ… å—è®¾å¤‡ (block_dev.c) - 100%
- âœ… ç¼“å†²åŒºç¼“å­˜ (buffer_cache.c) - 100%
- âœ… å—åˆ†é…å™¨ (block_alloc.c) - 100%
- âœ… Inode ç®¡ç† (inode.c) - 100%
- âœ… ç›®å½•ç®¡ç† (directory.c) - 100%
- âœ… è·¯å¾„è§£æ (path.c) - 100%
- âœ… è¶…çº§å— (superblock.c) - 100%
- âœ… fs_context (fs_context.c) - 100%

### Rust ç»„ä»¶
- âœ… Journal Manager - 100%
- âœ… Extent Allocator - 100%
- âœ… FFI å±‚ - 100%

### åŠŸèƒ½åœºæ™¯
- âœ… æ–‡ä»¶æ“ä½œ - å®Œå…¨è¦†ç›–
- âœ… ç›®å½•æ“ä½œ - å®Œå…¨è¦†ç›–
- âœ… é”™è¯¯å¤„ç† - å®Œå…¨è¦†ç›–
- âœ… å´©æºƒæ¢å¤ - å®Œå…¨è¦†ç›–
- âœ… æ€§èƒ½æµ‹è¯• - å®Œå…¨è¦†ç›–

---

## âœ… éªŒè¯å®Œæˆæ ‡å¿—

å½“ä½ å®Œæˆæ‰€æœ‰æ£€æŸ¥é¡¹åï¼Œåº”è¯¥èƒ½å¤Ÿï¼š

1. âœ… è¿è¡Œ `./run_full_test_suite.sh` çœ‹åˆ°æ‰€æœ‰æµ‹è¯•é€šè¿‡
2. âœ… æ¯ä¸ªå•ç‹¬çš„æµ‹è¯•éƒ½èƒ½æˆåŠŸè¿è¡Œ
3. âœ… æ²¡æœ‰å†…å­˜æ³„æ¼æˆ–å´©æºƒ
4. âœ… æ€§èƒ½æŒ‡æ ‡åœ¨åˆç†èŒƒå›´å†…
5. âœ… æ–‡æ¡£é½å…¨ä¸”å‡†ç¡®

**æ­å–œï¼ModernFS çš„æµ‹è¯•å¥—ä»¶å·²ç»å®Œå…¨å°±ç»ªï¼** ğŸ‰

---

## ğŸ“ æŠ¥å‘Šé—®é¢˜

å¦‚æœå‘ç°ä»»ä½•é—®é¢˜ï¼Œè¯·è®°å½•ï¼š

1. **æµ‹è¯•åç§°**: å“ªä¸ªæµ‹è¯•å¤±è´¥äº†ï¼Ÿ
2. **é”™è¯¯ä¿¡æ¯**: å®Œæ•´çš„é”™è¯¯è¾“å‡º
3. **ç¯å¢ƒä¿¡æ¯**: 
   - æ“ä½œç³»ç»Ÿç‰ˆæœ¬
   - Rust ç‰ˆæœ¬ (`rustc --version`)
   - GCC ç‰ˆæœ¬ (`gcc --version`)
4. **é‡ç°æ­¥éª¤**: å¦‚ä½•è§¦å‘è¯¥é—®é¢˜ï¼Ÿ

---

## ğŸš€ ä¸‹ä¸€æ­¥

æµ‹è¯•å…¨éƒ¨é€šè¿‡åï¼Œä½ å¯ä»¥ï¼š

1. è¿è¡Œ FUSE é›†æˆæµ‹è¯•
   ```bash
   ./tests/scripts/test_fuse_simple.sh
   ```

2. è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
   ```bash
   ./tools/benchmark-rs/target/release/benchmark-modernfs
   ```

3. æµ‹è¯•å´©æºƒæ¢å¤
   ```bash
   ./tests/crash/run_all.sh
   ```

---

**ä¿æŒè¿™ä¸ªæ¸…å•å¹¶åœ¨æ¯æ¬¡ä¿®æ”¹ä»£ç åé‡æ–°éªŒè¯ï¼** âœ¨
