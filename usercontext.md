# ModernFS 学习历程记录

**学习者身份**: 初学者
**开始日期**: 2025-10-10
**学习目标**: 深入理解 ModernFS 文件系统的核心技术和架构设计

---

## 学习路线图

### 阶段一: 基础入门 (1-2周)

#### 1. 环境搭建与快速开始 ✅
- [x] 1.1 环境要求
  - [x] 了解 Linux/WSL 环境要求
  - [x] 确认 Rust 和 C 编译工具链
  - [x] 理解 FUSE 依赖
- [x] 1.2 安装步骤
  - [x] 克隆仓库
  - [x] 安装系统依赖
  - [x] 构建项目 (./build.sh)
  - [x] 验证安装成功
- [x] 1.3 第一次使用
  - [x] 创建文件系统镜像
  - [x] 挂载文件系统
  - [x] 执行基本文件操作
  - [x] 正确卸载

**学习成果**: 能够独立搭建环境并执行基本的文件系统操作

---

#### 2. 工具使用掌握 📋
- [ ] 2.1 mkfs-modernfs (格式化工具)
  - [ ] 理解超级块、日志区、数据区的布局
  - [ ] 掌握基本格式化命令
  - [ ] 实验不同大小参数 (--size, --journal-size)
  - [ ] 理解日志大小对性能的影响
  - [ ] 使用 --verbose 查看详细信息

- [ ] 2.2 fsck-modernfs (文件系统检查)
  - [ ] 理解 6 个检查阶段的作用
  - [ ] 运行基本检查命令
  - [ ] 使用 --check-journal 深入检查
  - [ ] 实验故意损坏文件系统并检测
  - [ ] 理解何时需要运行 fsck

- [ ] 2.3 benchmark-modernfs (性能测试)
  - [ ] 了解各种测试类型 (顺序读写、随机读写、元数据操作)
  - [ ] 运行完整基准测试
  - [ ] 分析性能数据
  - [ ] 对比不同配置的性能差异
  - [ ] 理解 ModernFS 与传统文件系统的性能差异

- [ ] 2.4 modernfs (FUSE驱动)
  - [ ] 理解 FUSE 工作原理
  - [ ] 掌握前台/后台挂载
  - [ ] 使用调试模式 (-d) 观察日志
  - [ ] 理解各种 FUSE 选项

**学习成果**: 熟练使用所有工具，能够诊断基本问题

---

#### 3. 常见操作实践 📋
- [ ] 3.1 创建和使用文件系统
  - [ ] 完整工作流实践
  - [ ] 创建目录树结构
  - [ ] 批量文件操作

- [ ] 3.2 备份和恢复
  - [ ] 备份整个文件系统
  - [ ] 恢复损坏的文件系统
  - [ ] 迁移到另一台机器

- [ ] 3.3 监控文件系统使用
  - [ ] 查看空间使用 (df -h)
  - [ ] 查看 Inode 使用 (df -i)
  - [ ] 理解何时会耗尽空间/Inode

- [ ] 3.4 性能优化
  - [ ] 调整日志大小实验
  - [ ] 使用 RAM disk 提升性能
  - [ ] 理解性能瓶颈

**学习成果**: 能够处理日常文件系统管理任务

---

### 阶段二: 架构理解 (2-3周)

#### 4. 混合架构设计 📋
- [ ] 4.1 C 组件理解
  - [ ] FUSE 接口层 (fuse_ops.c, main_fuse.c)
    - [ ] 理解 POSIX 系统调用映射
    - [ ] 阅读 getattr, read, write 实现
  - [ ] 块设备层 (block_dev.c, buffer_cache.c)
    - [ ] 理解块 I/O 抽象
    - [ ] 学习 LRU 缓存算法
  - [ ] Inode 层 (inode.c)
    - [ ] 理解 Inode 结构 (直接/间接块)
    - [ ] 学习 Inode 缓存机制
  - [ ] 目录层 (directory.c)
    - [ ] 理解变长目录项设计
    - [ ] 学习路径查找算法

- [ ] 4.2 Rust 组件理解
  - [ ] Journal Manager (rust_core/src/journal/)
    - [ ] 理解 WAL (Write-Ahead Logging) 原理
    - [ ] 学习事务状态机 (Active → Committed → Checkpointed)
    - [ ] 理解崩溃恢复机制
  - [ ] Extent Allocator (rust_core/src/extent/)
    - [ ] 理解 Extent 分配算法 (First-Fit)
    - [ ] 学习碎片跟踪机制
    - [ ] 理解双重释放检测

- [ ] 4.3 FFI 接口
  - [ ] 理解 Rust 与 C 的互操作
  - [ ] 学习 #[no_mangle] 和 extern "C"
  - [ ] 理解内存管理 (Box::into_raw)
  - [ ] 学习错误处理 (catch_panic)

**学习成果**: 理解混合架构的设计思想和各层职责

---

#### 5. 核心数据结构 📋
- [ ] 5.1 磁盘布局
  - [ ] 绘制磁盘布局图
  - [ ] 计算各区域大小
  - [ ] 理解超级块字段

- [ ] 5.2 Inode 结构
  - [ ] 理解 12 直接块 + 间接块设计
  - [ ] 计算最大文件大小
  - [ ] 理解 Inode 位图

- [ ] 5.3 Journal 结构
  - [ ] 理解循环缓冲区设计
  - [ ] 学习事务记录格式
  - [ ] 理解 Checkpoint 过程

- [ ] 5.4 Buffer Cache
  - [ ] 理解哈希表 + LRU 设计
  - [ ] 学习线程安全机制 (pthread_rwlock_t)

**学习成果**: 掌握核心数据结构的设计原理

---

### 阶段三: 故障处理与优化 (1-2周)

#### 6. 故障排除实践 📋
- [ ] 6.1 挂载失败
  - [ ] 模拟各种挂载失败场景
  - [ ] 掌握调试方法

- [ ] 6.2 性能问题
  - [ ] 诊断写入慢问题
  - [ ] 诊断读取慢问题
  - [ ] 使用 benchmark 定位瓶颈

- [ ] 6.3 数据丢失
  - [ ] 模拟崩溃场景
  - [ ] 实践恢复流程
  - [ ] 理解 Journal 恢复机制

- [ ] 6.4 崩溃和卡死
  - [ ] 使用 gdb 调试 C 代码
  - [ ] 分析崩溃日志

**学习成果**: 能够独立诊断和解决常见问题

---

#### 7. 限制与设计权衡 📋
- [ ] 7.1 已知限制
  - [ ] 理解每个限制背后的设计原因
  - [ ] 思考如何改进

- [ ] 7.2 适用/不适用场景
  - [ ] 理解教学项目的定位
  - [ ] 对比生产级文件系统

- [ ] 7.3 安全建议
  - [ ] 实践备份策略
  - [ ] 实践监控策略

**学习成果**: 理解设计权衡，能够评估技术选型

---

### 阶段四: 深入源码 (3-4周)

#### 8. 开发流程实践 📋
- [ ] 8.1 添加新 C 模块
  - [ ] 创建简单的 C 模块
  - [ ] 编写单元测试
  - [ ] 更新 CMakeLists.txt

- [ ] 8.2 添加 Rust 功能
  - [ ] 实现简单的 Rust 功能
  - [ ] 导出 FFI 接口
  - [ ] 在 C 代码中调用

- [ ] 8.3 常见陷阱
  - [ ] 理解 Packed Structs 问题
  - [ ] 理解 WSL 路径转换
  - [ ] 理解 FFI 生命周期管理

**学习成果**: 能够修改和扩展代码库

---

#### 9. 测试策略 📋
- [ ] 9.1 单元测试
  - [ ] 运行所有单元测试
  - [ ] 理解测试设计
  - [ ] 编写新的测试用例

- [ ] 9.2 集成测试
  - [ ] 运行 Rust/C 集成测试
  - [ ] 理解测试边界

- [ ] 9.3 FUSE 测试
  - [ ] 运行脚本测试
  - [ ] 编写新的测试脚本

**学习成果**: 掌握测试驱动开发流程

---

#### 10. 项目阶段回顾 📋
- [ ] 10.1 Week 1-3: 基础层
  - [ ] 回顾 FFI, Block Layer, Inode Layer 实现
  - [ ] 阅读周报理解设计决策

- [ ] 10.2 Week 4-5: FUSE & Journal
  - [ ] 理解 FUSE 集成
  - [ ] 深入学习 WAL 实现

- [ ] 10.3 Week 6: Extent Allocator
  - [ ] 理解 Extent 分配策略
  - [ ] 学习碎片管理

- [ ] 10.4 Week 7+: 未来计划
  - [ ] 了解 Journal + Extent 集成计划
  - [ ] 了解 Rust 工具链计划

**学习成果**: 全面理解项目演进过程

---

## 学习资源

### 必读文档
- [x] docs/USER_GUIDE.md - 用户手册 (第1章已完成)
- [ ] docs/IMPLEMENTATION.md - 实现细节
- [ ] docs/DEVELOPER.md - 开发指南
- [ ] docs/WEEK*_REPORT.md - 周报 (了解设计演进)
- [ ] CLAUDE.md - 项目说明

### 推荐资源
- [ ] [FUSE Documentation](https://libfuse.github.io/)
- [ ] [Rust FFI Guide](https://doc.rust-lang.org/nomicon/ffi.html)
- [ ] [xv6 Filesystem](https://pdos.csail.mit.edu/6.828/2020/xv6/book-riscv-rev1.pdf)

---

## 学习笔记

### 第1章: 快速开始 (已完成 ✅)

**关键收获**:
- 理解了 ModernFS 的混合架构 (C + Rust)
- 掌握了基本的构建流程 (./build.sh)
- 学会了创建、挂载、使用文件系统的完整流程
- 理解了 WSL 在 Windows 环境下的必要性

**重要概念**:
- **FUSE**: 用户态文件系统，不需要内核模块
- **镜像文件**: disk.img 是文件系统的容器
- **挂载点**: /mnt/test 是访问文件系统的入口
- **正确卸载**: fusermount -u 避免数据丢失

**实践经验**:
```bash
# 成功执行的第一个完整流程
./target/release/mkfs-modernfs mydisk.img --size 256M
sudo mkdir -p /mnt/modernfs
sudo ./build/modernfs mydisk.img /mnt/modernfs -f &
echo "Hello, ModernFS!" > /mnt/modernfs/test.txt
cat /mnt/modernfs/test.txt
sudo fusermount -u /mnt/modernfs
```

**疑问与待探索**:
- [ ] Journal 日志系统的具体工作原理？
- [ ] Extent Allocator 如何优化碎片？
- [ ] 为什么性能比 ext4 低这么多？
- [ ] 如何实现崩溃一致性？

---

### 待更新...

*(在学习每个新阶段后，在此处记录笔记)*

---

## 进度追踪

| 阶段 | 进度 | 预计完成日期 | 实际完成日期 |
|------|------|-------------|-------------|
| 阶段一: 基础入门 | 20% | 2025-10-24 | - |
| 阶段二: 架构理解 | 0% | 2025-11-14 | - |
| 阶段三: 故障处理 | 0% | 2025-11-28 | - |
| 阶段四: 深入源码 | 0% | 2025-12-26 | - |

**当前焦点**: 第2章 工具使用掌握

---

## 学习目标

### 短期目标 (1个月)
- [ ] 完成阶段一所有内容
- [ ] 能够独立操作所有 CLI 工具
- [ ] 理解文件系统的基本概念

### 中期目标 (2个月)
- [ ] 完成阶段二，理解混合架构
- [ ] 能够阅读和理解核心代码
- [ ] 掌握 C/Rust FFI 机制

### 长期目标 (3个月)
- [ ] 完成所有阶段
- [ ] 能够修改和扩展功能
- [ ] 贡献代码或撰写技术文章

---

**最后更新**: 2025-10-10
**下次更新计划**: 完成第2章后
