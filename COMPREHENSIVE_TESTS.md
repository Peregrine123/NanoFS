# ModernFS å…¨é¢æµ‹è¯•æ–‡æ¡£

æœ¬æ–‡æ¡£æè¿°äº† ModernFS æ–‡ä»¶ç³»ç»Ÿçš„å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼Œç¡®ä¿ Rust å’Œ C ç»„ä»¶çš„æ‰€æœ‰åŠŸèƒ½éƒ½ç»è¿‡å……åˆ†æµ‹è¯•ã€‚

## æµ‹è¯•æ¦‚è§ˆ

### æµ‹è¯•ç›®æ ‡
- âœ… **å®Œæ•´åŠŸèƒ½è¦†ç›–**ï¼šæµ‹è¯•æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- âœ… **Rust/C é›†æˆ**ï¼šéªŒè¯ FFI æ¥å£çš„æ­£ç¡®æ€§
- âœ… **é”™è¯¯å¤„ç†**ï¼šæµ‹è¯•å„ç§å¼‚å¸¸æƒ…å†µçš„å¤„ç†
- âœ… **æ€§èƒ½åŸºå‡†**ï¼šè¯„ä¼°ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- âœ… **å´©æºƒä¸€è‡´æ€§**ï¼šéªŒè¯ WAL æ—¥å¿—çš„æ¢å¤èƒ½åŠ›
- âœ… **èµ„æºè€—å°½**ï¼šæµ‹è¯•ç£ç›˜æ»¡ã€inode è€—å°½ç­‰åœºæ™¯

### æµ‹è¯•ç»Ÿè®¡
- **æ€»æµ‹è¯•æ–‡ä»¶**ï¼š13 ä¸ª
- **æµ‹è¯•åœºæ™¯**ï¼š60+ ä¸ª
- **ä»£ç è¦†ç›–**ï¼šæ‰€æœ‰ä¸»è¦æ¨¡å—
  - C ç»„ä»¶ï¼šå—è®¾å¤‡ã€ç¼“å­˜ã€åˆ†é…å™¨ã€inodeã€ç›®å½•ã€è·¯å¾„
  - Rust ç»„ä»¶ï¼šJournal Managerã€Extent Allocator
  - é›†æˆï¼šfs_contextã€FUSE æ¥å£

---

## æµ‹è¯•å¥—ä»¶è¯¦ç»†è¯´æ˜

### 1. åŸºç¡€ç»„ä»¶æµ‹è¯•

#### 1.1 `test_ffi.c` - FFI æ¥å£æµ‹è¯•
**ç›®çš„**ï¼šéªŒè¯ Rust/C åŸºç¡€äº’æ“ä½œ

**æµ‹è¯•å†…å®¹**ï¼š
- Rust åº“åŠ è½½å’Œåˆå§‹åŒ–
- åŸºç¡€ FFI å‡½æ•°è°ƒç”¨
- æ•°æ®ç±»å‹è½¬æ¢
- å†…å­˜ç®¡ç†ï¼ˆè·¨è¯­è¨€è¾¹ç•Œï¼‰

**å‘½ä»¤**ï¼š`./build/test_ffi`

---

#### 1.2 `test_block_layer.c` - å—è®¾å¤‡å±‚æµ‹è¯•
**ç›®çš„**ï¼šæµ‹è¯•åº•å±‚å—è®¾å¤‡å’Œç¼“å­˜åŠŸèƒ½

**æµ‹è¯•åœºæ™¯**ï¼š
1. **å—è®¾å¤‡åŸºç¡€æ“ä½œ**
   - æ‰“å¼€/å…³é—­å—è®¾å¤‡
   - è¯»å–å•ä¸ªå—
   - å†™å…¥å•ä¸ªå—
   - åŒæ­¥ç£ç›˜

2. **ç¼“å†²åŒºç¼“å­˜**
   - LRU ç¼“å­˜å‘½ä¸­/æœªå‘½ä¸­
   - ç¼“å­˜ç»Ÿè®¡
   - è„å—å†™å›
   - ç¼“å­˜æ·˜æ±°ç­–ç•¥

3. **å—åˆ†é…å™¨**
   - å•å—åˆ†é…
   - è¿ç»­å¤šå—åˆ†é…
   - å—é‡Šæ”¾
   - ä½å›¾ç®¡ç†

4. **è¾¹ç•Œæ¡ä»¶**
   - è¶Šç•Œè¯»å†™æ£€æµ‹
   - å¹¶å‘è®¿é—®

**å‘½ä»¤**ï¼š`./build/test_block_layer`

---

#### 1.3 `test_inode_layer.c` - Inode å±‚æµ‹è¯•
**ç›®çš„**ï¼šæµ‹è¯• inodeã€ç›®å½•å’Œè·¯å¾„ç®¡ç†

**æµ‹è¯•åœºæ™¯**ï¼š
1. **Inode åˆ†é…ä¸é‡Šæ”¾**
   - æ–‡ä»¶ inode åˆ†é…
   - ç›®å½• inode åˆ†é…
   - Inode åŒæ­¥åˆ°ç£ç›˜
   - Inode é‡Šæ”¾

2. **æ–‡ä»¶è¯»å†™**
   - å°æ•°æ®å†™å…¥ï¼ˆå•å—ï¼‰
   - å¤§æ•°æ®å†™å…¥ï¼ˆè·¨å—ï¼‰
   - ç›´æ¥å—æ˜ å°„
   - é—´æ¥å—æ˜ å°„

3. **ç›®å½•æ“ä½œ**
   - æ·»åŠ ç›®å½•é¡¹
   - æŸ¥æ‰¾ç›®å½•é¡¹
   - åˆ é™¤ç›®å½•é¡¹
   - ç›®å½•é¡¹éªŒè¯

4. **è·¯å¾„æ“ä½œ**
   - è·¯å¾„è§„èŒƒåŒ–ï¼ˆ`/a/b/../c` â†’ `/a/c`ï¼‰
   - basename æå–
   - dirname æå–

5. **æ•°æ®å—æ˜ å°„**
   - ç›´æ¥å—ï¼ˆå‰ 12 å—ï¼‰
   - ä¸€çº§é—´æ¥å—
   - è·¨è¶Šé—´æ¥å—çš„è¯»å†™

**å‘½ä»¤**ï¼š`./build/test_inode_layer`

---

### 2. Rust ç»„ä»¶æµ‹è¯•

#### 2.1 `test_journal.c` - Journal Manager æµ‹è¯•
**ç›®çš„**ï¼šæµ‹è¯• Rust å®ç°çš„ WAL æ—¥å¿—ç³»ç»Ÿ

**æµ‹è¯•åœºæ™¯**ï¼š
1. **åˆå§‹åŒ–**
   - Journal Manager åˆå§‹åŒ–
   - è¶…çº§å—åˆ›å»º
   - æ—¥å¿—åŒºåŸŸåˆ†é…

2. **äº‹åŠ¡æ“ä½œ**
   - å¼€å§‹äº‹åŠ¡
   - å†™å…¥æ•°æ®åˆ°äº‹åŠ¡
   - æäº¤äº‹åŠ¡
   - å›æ»šäº‹åŠ¡ï¼ˆabortï¼‰

3. **Checkpoint**
   - æ‰§è¡Œ checkpoint
   - æ•°æ®å†™å…¥æœ€ç»ˆä½ç½®
   - æ—¥å¿—ç©ºé—´å›æ”¶

4. **å´©æºƒæ¢å¤**
   - æ¨¡æ‹Ÿå´©æºƒï¼ˆä¸æ‰§è¡Œ checkpointï¼‰
   - é‡æ–°æŒ‚è½½
   - è‡ªåŠ¨æ¢å¤æœª checkpoint çš„äº‹åŠ¡

5. **å¤šäº‹åŠ¡å¹¶å‘**
   - æäº¤å¤šä¸ªè¿ç»­äº‹åŠ¡
   - éªŒè¯äº‹åŠ¡é¡ºåº

**å‘½ä»¤**ï¼š`./build/test_journal`

---

#### 2.2 `test_extent.c` - Extent Allocator æµ‹è¯•
**ç›®çš„**ï¼šæµ‹è¯• Rust å®ç°çš„è¿ç»­å—åˆ†é…å™¨

**æµ‹è¯•åœºæ™¯**ï¼š
1. **åˆå§‹åŒ–ä¸é”€æ¯**
   - Extent Allocator åˆå§‹åŒ–
   - ç»Ÿè®¡ä¿¡æ¯è·å–
   - èµ„æºæ¸…ç†

2. **å•æ¬¡åˆ†é…ä¸é‡Šæ”¾**
   - åˆ†é…æŒ‡å®šå¤§å°çš„ extent
   - é‡Šæ”¾ extent
   - ç»Ÿè®¡éªŒè¯

3. **å¤šæ¬¡åˆ†é…ï¼ˆç¢ç‰‡åŒ–ï¼‰**
   - åˆ†é…å¤šä¸ªå° extent
   - åˆ¶é€ ç¢ç‰‡ï¼ˆé‡Šæ”¾å¥‡æ•°ç¼–å·ï¼‰
   - ç¢ç‰‡ç‡ç»Ÿè®¡

4. **Double-Free æ£€æµ‹**
   - åˆ†é… extent
   - ç¬¬ä¸€æ¬¡é‡Šæ”¾ï¼ˆæˆåŠŸï¼‰
   - ç¬¬äºŒæ¬¡é‡Šæ”¾ï¼ˆåº”å¤±è´¥ï¼‰

5. **ç©ºé—´è€—å°½**
   - åˆ†é…æ‰€æœ‰å¯ç”¨ç©ºé—´
   - éªŒè¯ç©ºé—´è€—å°½æ£€æµ‹

6. **First-Fit ç®—æ³•**
   - éªŒè¯ First-Fit åˆ†é…ç­–ç•¥
   - æµ‹è¯• hint å‚æ•°æ•ˆæœ

7. **ç£ç›˜åŒæ­¥**
   - ä½å›¾åŒæ­¥åˆ°ç£ç›˜
   - é‡æ–°åŠ è½½éªŒè¯æŒä¹…åŒ–

**å‘½ä»¤**ï¼š`./build/test_extent`

---

### 3. é›†æˆæµ‹è¯•

#### 3.1 `test_week7_integration.c` - Journal + Extent é›†æˆ
**ç›®çš„**ï¼šæµ‹è¯• Journal å’Œ Extent ååŒå·¥ä½œ

**æµ‹è¯•åœºæ™¯**ï¼š
1. **fs_context åˆå§‹åŒ–**
   - éªŒè¯æ‰€æœ‰ç»„ä»¶åˆå§‹åŒ–
   - Checkpoint çº¿ç¨‹å¯åŠ¨

2. **Journal äº‹åŠ¡**
   - ä½¿ç”¨ fs_context æ‰§è¡Œäº‹åŠ¡

3. **Extent åˆ†é…**
   - ä½¿ç”¨ fs_context åˆ†é… extent

4. **Checkpoint åŠŸèƒ½**
   - åˆ›å»ºå¤šä¸ªäº‹åŠ¡
   - æ‰§è¡Œ checkpoint

5. **å´©æºƒæ¢å¤**
   - æ¨¡æ‹Ÿå´©æºƒ
   - é‡æ–°æŒ‚è½½æ¢å¤

6. **fs_context_sync**
   - å®Œæ•´åŒæ­¥æµç¨‹

**å‘½ä»¤**ï¼š`./build/test_week7_integration`

---

#### 3.2 `test_full_coverage.c` - å®Œæ•´è¦†ç›–æµ‹è¯• â­
**ç›®çš„**ï¼šæµ‹è¯•æ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰å…³é”®è·¯å¾„

**æµ‹è¯•åœºæ™¯**ï¼š
1. **å®Œæ•´æ–‡ä»¶ç³»ç»Ÿåˆå§‹åŒ–**
   - å—è®¾å¤‡
   - è¶…çº§å—
   - å—åˆ†é…å™¨
   - Inode ç¼“å­˜
   - Journal Manager (Rust)
   - Extent Allocator (Rust)
   - Checkpoint çº¿ç¨‹

2. **æ–‡ä»¶åŸºæœ¬æ“ä½œ**
   - åˆ›å»ºæ–‡ä»¶
   - å†™å…¥æ•°æ®
   - è¯»å–æ•°æ®
   - éªŒè¯æ•°æ®ä¸€è‡´æ€§
   - åˆ é™¤æ–‡ä»¶

3. **ç›®å½•æ“ä½œ**
   - åˆ›å»ºå­ç›®å½•
   - åœ¨å­ç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶
   - ç›®å½•é¡¹æŸ¥æ‰¾

4. **è¾¹ç•Œæ¡ä»¶**
   - ç©ºæ–‡ä»¶æµ‹è¯•
   - å¤§æ–‡ä»¶æµ‹è¯•ï¼ˆ5 ä¸ªå—ï¼Œ20KBï¼‰
   - æ•°æ®éªŒè¯

5. **Rust/C é›†æˆ**
   - Extent åˆ†é…
   - Journal äº‹åŠ¡
   - äº‹åŠ¡å†™å…¥åˆ†é…çš„å—
   - æäº¤äº‹åŠ¡
   - Checkpoint
   - é‡Šæ”¾ extent

6. **è·¯å¾„è§£æ**
   - å¤æ‚è·¯å¾„è§„èŒƒåŒ–
   - basename/dirname æµ‹è¯•

7. **å´©æºƒä¸€è‡´æ€§**
   - åˆ›å»ºäº‹åŠ¡
   - æ¨¡æ‹Ÿå´©æºƒï¼ˆä¸ checkpointï¼‰
   - é‡æ–°æŒ‚è½½
   - éªŒè¯æ¢å¤

**å‘½ä»¤**ï¼š`./build/test_full_coverage`

**é¢„æœŸç»“æœ**ï¼š7/7 æµ‹è¯•é€šè¿‡

---

#### 3.3 `test_error_handling.c` - é”™è¯¯å¤„ç†æµ‹è¯• â­
**ç›®çš„**ï¼šæµ‹è¯•å¼‚å¸¸æƒ…å†µçš„å¤„ç†èƒ½åŠ›

**æµ‹è¯•åœºæ™¯**ï¼š
1. **ç£ç›˜ç©ºé—´è€—å°½**
   - æŒç»­åˆ›å»ºæ–‡ä»¶ç›´åˆ°å¤±è´¥
   - éªŒè¯é”™è¯¯å¤„ç†

2. **æ— æ•ˆå‚æ•°æ£€æµ‹**
   - æ— æ•ˆ inode å·
   - NULL æŒ‡é’ˆ
   - ç©ºæ–‡ä»¶å
   - è¿‡é•¿æ–‡ä»¶å

3. **Double-Free æ£€æµ‹**
   - Extent double-free
   - éªŒè¯æ£€æµ‹æœºåˆ¶

4. **é‡å¤æ–‡ä»¶å**
   - åˆ›å»ºåŒåæ–‡ä»¶
   - éªŒè¯æ‹’ç»æ“ä½œ

5. **ä¸å­˜åœ¨çš„æ–‡ä»¶**
   - æŸ¥æ‰¾ä¸å­˜åœ¨çš„æ–‡ä»¶
   - éªŒè¯ ENOENT é”™è¯¯

6. **åˆ é™¤ä¸å­˜åœ¨çš„æ–‡ä»¶**
   - åˆ é™¤ä¸å­˜åœ¨çš„æ–‡ä»¶
   - éªŒè¯é”™è¯¯ç 

7. **Extent è¾¹ç•Œæ£€æŸ¥**
   - åˆ†é…è¶…è¿‡å®¹é‡
   - é‡Šæ”¾æ— æ•ˆèŒƒå›´

8. **Journal äº‹åŠ¡å›æ»š**
   - å¼€å§‹äº‹åŠ¡
   - å†™å…¥æ•°æ®
   - å›æ»š
   - éªŒè¯ç¨³å®šæ€§

**å‘½ä»¤**ï¼š`./build/test_error_handling`

**é¢„æœŸç»“æœ**ï¼š8/8 æµ‹è¯•é€šè¿‡

---

#### 3.4 `test_stress.c` - å‹åŠ›æµ‹è¯• â­
**ç›®çš„**ï¼šæµ‹è¯•é«˜è´Ÿè½½ä¸‹çš„æ€§èƒ½å’Œç¨³å®šæ€§

**æµ‹è¯•åœºæ™¯**ï¼š
1. **å¤§é‡å°æ–‡ä»¶åˆ›å»º**
   - åˆ›å»º 1000 ä¸ªå°æ–‡ä»¶
   - ç»Ÿè®¡åˆ›å»ºé€Ÿåº¦
   - è®¡ç®—ååé‡ï¼ˆæ–‡ä»¶/ç§’ï¼‰

2. **å¤§æ–‡ä»¶é¡ºåºå†™å…¥**
   - å†™å…¥ 10MB æ–‡ä»¶
   - ç»Ÿè®¡å†™å…¥é€Ÿåº¦ï¼ˆMB/sï¼‰
   - 64KB å—å¤§å°å†™å…¥

3. **å¤§æ–‡ä»¶é¡ºåºè¯»å–**
   - è¯»å–ä¹‹å‰åˆ›å»ºçš„å¤§æ–‡ä»¶
   - ç»Ÿè®¡è¯»å–é€Ÿåº¦ï¼ˆMB/sï¼‰

4. **éšæœºè¯»å†™**
   - 1000 æ¬¡éšæœº I/O æ“ä½œ
   - åœ¨ 1MB èŒƒå›´å†…éšæœºåç§»
   - ç»Ÿè®¡ IOPS å’Œå¹³å‡å»¶è¿Ÿ

5. **æ·±å±‚ç›®å½•ç»“æ„**
   - åˆ›å»º 10 å±‚åµŒå¥—ç›®å½•
   - åœ¨æœ€æ·±å±‚åˆ›å»ºæ–‡ä»¶

6. **ç¢ç‰‡åŒ–åœºæ™¯**
   - åˆ†é… 50 ä¸ª extent
   - é‡Šæ”¾å¥‡æ•°ç¼–å·åˆ¶é€ ç¢ç‰‡
   - ç»Ÿè®¡ç¢ç‰‡ç‡
   - æµ‹è¯•åœ¨ç¢ç‰‡åŒ–ç£ç›˜ä¸Šåˆ†é…

**å‘½ä»¤**ï¼š`./build/test_stress`

**é¢„æœŸç»“æœ**ï¼š6/6 æµ‹è¯•é€šè¿‡

**æ€§èƒ½æŒ‡æ ‡**ï¼ˆå‚è€ƒï¼‰ï¼š
- å°æ–‡ä»¶åˆ›å»ºï¼š> 100 æ–‡ä»¶/ç§’
- é¡ºåºå†™å…¥ï¼šå–å†³äºç£ç›˜æ€§èƒ½
- éšæœº IOPSï¼šå–å†³äºç¼“å­˜æ•ˆç‡

---

### 4. å¹¶å‘æµ‹è¯•

#### 4.1 `test_concurrent_writes.c`
**ç›®çš„**ï¼šæµ‹è¯•å¹¶å‘å†™å…¥çš„æ­£ç¡®æ€§

**æµ‹è¯•åœºæ™¯**ï¼š
- å¤šçº¿ç¨‹åŒæ—¶å†™å…¥ä¸åŒå—
- éªŒè¯æ•°æ®ä¸€è‡´æ€§

**å‘½ä»¤**ï¼š`./build/test_concurrent_writes`

---

#### 4.2 `test_concurrent_alloc.c`
**ç›®çš„**ï¼šæµ‹è¯•å¹¶å‘å—åˆ†é…

**æµ‹è¯•åœºæ™¯**ï¼š
- å¤šçº¿ç¨‹åŒæ—¶åˆ†é…å—
- éªŒè¯æ²¡æœ‰é‡å¤åˆ†é…

**å‘½ä»¤**ï¼š`./build/test_concurrent_alloc`

---

### 5. Rust å•å…ƒæµ‹è¯•

#### 5.1 Cargo Test
**ç›®çš„**ï¼šæµ‹è¯• Rust ç»„ä»¶çš„å†…éƒ¨é€»è¾‘

**æµ‹è¯•å†…å®¹**ï¼š
- Journal Manager å•å…ƒæµ‹è¯•
- Extent Allocator å•å…ƒæµ‹è¯•
- ä½å›¾æ“ä½œæµ‹è¯•
- äº‹åŠ¡çŠ¶æ€æœºæµ‹è¯•

**å‘½ä»¤**ï¼š`cargo test --manifest-path rust_core/Cargo.toml --release`

---

## è¿è¡Œæ‰€æœ‰æµ‹è¯•

### æ–¹æ³• 1ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
chmod +x run_full_test_suite.sh
./run_full_test_suite.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æ£€æŸ¥æ„å»ºç³»ç»Ÿ
2. ç¼–è¯‘ Rust åº“
3. ç¼–è¯‘ C ä»£ç å’Œæµ‹è¯•
4. æŒ‰é¡ºåºè¿è¡Œæ‰€æœ‰æµ‹è¯•
5. ç»Ÿè®¡æµ‹è¯•ç»“æœ
6. æ˜¾ç¤ºè¦†ç›–èŒƒå›´

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨è¿è¡Œ

```bash
# 1. æ„å»º
./build.sh

# 2. è¿è¡ŒåŸºç¡€æµ‹è¯•
./build/test_ffi
./build/test_block_layer
./build/test_inode_layer

# 3. è¿è¡Œ Rust ç»„ä»¶æµ‹è¯•
./build/test_journal
./build/test_extent

# 4. è¿è¡Œé›†æˆæµ‹è¯•
./build/test_week7_integration
./build/test_full_coverage
./build/test_error_handling
./build/test_stress

# 5. è¿è¡Œå¹¶å‘æµ‹è¯•
./build/test_concurrent_writes
./build/test_concurrent_alloc

# 6. Rust å•å…ƒæµ‹è¯•
cargo test --manifest-path rust_core/Cargo.toml --release
```

---

## æµ‹è¯•è¦†ç›–èŒƒå›´

### C ç»„ä»¶è¦†ç›–

| æ¨¡å— | æ–‡ä»¶ | æµ‹è¯•è¦†ç›– |
|------|------|---------|
| å—è®¾å¤‡ | `block_dev.c` | âœ… å®Œå…¨è¦†ç›– |
| ç¼“å†²åŒºç¼“å­˜ | `buffer_cache.c` | âœ… å®Œå…¨è¦†ç›– |
| å—åˆ†é…å™¨ | `block_alloc.c` | âœ… å®Œå…¨è¦†ç›– |
| Inode ç®¡ç† | `inode.c` | âœ… å®Œå…¨è¦†ç›– |
| ç›®å½•ç®¡ç† | `directory.c` | âœ… å®Œå…¨è¦†ç›– |
| è·¯å¾„è§£æ | `path.c` | âœ… å®Œå…¨è¦†ç›– |
| è¶…çº§å— | `superblock.c` | âœ… å®Œå…¨è¦†ç›– |
| fs_context | `fs_context.c` | âœ… å®Œå…¨è¦†ç›– |
| FUSE æ¥å£ | `fuse_ops.c` | ğŸ”„ é›†æˆæµ‹è¯•è¦†ç›– |

### Rust ç»„ä»¶è¦†ç›–

| æ¨¡å— | æ–‡ä»¶ | æµ‹è¯•è¦†ç›– |
|------|------|---------|
| Journal Manager | `journal/mod.rs` | âœ… å®Œå…¨è¦†ç›– |
| Extent Allocator | `extent/mod.rs` | âœ… å®Œå…¨è¦†ç›– |
| FFI å±‚ | `lib.rs` | âœ… å®Œå…¨è¦†ç›– |
| äº‹åŠ¡ç®¡ç† | `journal/transaction.rs` | âœ… å®Œå…¨è¦†ç›– |
| Checkpoint | `journal/checkpoint.rs` | âœ… å®Œå…¨è¦†ç›– |
| ä½å›¾æ“ä½œ | `extent/bitmap.rs` | âœ… å®Œå…¨è¦†ç›– |

### åŠŸèƒ½åœºæ™¯è¦†ç›–

- âœ… æ–‡ä»¶åˆ›å»ºã€è¯»ã€å†™ã€åˆ é™¤
- âœ… ç›®å½•åˆ›å»ºã€åˆ—è¡¨ã€åˆ é™¤
- âœ… æ·±å±‚ç›®å½•ç»“æ„
- âœ… å°æ–‡ä»¶ï¼ˆ< 1 å—ï¼‰
- âœ… å¤§æ–‡ä»¶ï¼ˆ> 100 å—ï¼‰
- âœ… é¡ºåºè¯»å†™
- âœ… éšæœºè¯»å†™
- âœ… ç©ºæ–‡ä»¶
- âœ… è·¯å¾„è§£æ
- âœ… é”™è¯¯å¤„ç†
- âœ… èµ„æºè€—å°½
- âœ… å´©æºƒæ¢å¤
- âœ… äº‹åŠ¡å®Œæ•´æ€§
- âœ… ç¢ç‰‡åŒ–ç®¡ç†
- âœ… å¹¶å‘è®¿é—®

---

## æŒç»­é›†æˆå»ºè®®

### GitHub Actions é…ç½®ç¤ºä¾‹

```yaml
name: ModernFS CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libfuse3-dev cmake
    
    - name: Install Rust
      uses: actions-rust-lang/setup-rust-toolchain@v1
    
    - name: Run test suite
      run: |
        chmod +x run_full_test_suite.sh
        ./run_full_test_suite.sh
```

---

## æ€§èƒ½åŸºå‡†

### å‚è€ƒæ•°æ®ï¼ˆåœ¨å…¸å‹ç¡¬ä»¶ä¸Šï¼‰

| æ“ä½œ | ååé‡ | å»¶è¿Ÿ |
|------|--------|------|
| å°æ–‡ä»¶åˆ›å»º | 100-200 æ–‡ä»¶/ç§’ | 5-10 ms/æ–‡ä»¶ |
| é¡ºåºå†™å…¥ | å–å†³äºç£ç›˜ | - |
| é¡ºåºè¯»å– | å–å†³äºç£ç›˜ | - |
| éšæœº I/O | å–å†³äºç¼“å­˜ | 1-5 ms/op |
| äº‹åŠ¡æäº¤ | 50-100 txn/ç§’ | 10-20 ms/txn |
| Checkpoint | - | 100-500 ms |

---

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **mkfs.modernfs ä¸å­˜åœ¨**
   - è§£å†³ï¼šå…ˆè¿è¡Œ `./build.sh` æ„å»ºæ‰€æœ‰ç»„ä»¶

2. **æµ‹è¯•é•œåƒæƒé™é—®é¢˜**
   - è§£å†³ï¼šç¡®ä¿å½“å‰ç›®å½•å¯å†™

3. **Rust åº“é“¾æ¥å¤±è´¥**
   - è§£å†³ï¼šè¿è¡Œ `cargo build --release` é‡æ–°ç¼–è¯‘ Rust åº“

4. **æµ‹è¯•è¶…æ—¶**
   - åŸå› ï¼šå¯èƒ½æ˜¯æ€§èƒ½é—®é¢˜æˆ–æ­»é”
   - è§£å†³ï¼šæ£€æŸ¥æ—¥å¿—ï¼Œå¢åŠ è°ƒè¯•è¾“å‡º

---

## æ·»åŠ æ–°æµ‹è¯•

### æ­¥éª¤

1. **åˆ›å»ºæµ‹è¯•æ–‡ä»¶**
   ```c
   // tests/unit/test_my_feature.c
   #include "modernfs/...h"
   
   int main() {
       // æµ‹è¯•ä»£ç 
       return 0;
   }
   ```

2. **æ›´æ–° CMakeLists.txt**
   ```cmake
   add_executable(test_my_feature
       tests/unit/test_my_feature.c
       src/...c
   )
   
   target_link_libraries(test_my_feature
       ${RUST_CORE_LIB}
       pthread dl m
   )
   ```

3. **æ›´æ–°æµ‹è¯•è„šæœ¬**
   åœ¨ `run_full_test_suite.sh` ä¸­æ·»åŠ ï¼š
   ```bash
   run_test "My Featureæµ‹è¯•" "./build/test_my_feature"
   ```

4. **è¿è¡ŒéªŒè¯**
   ```bash
   ./build.sh
   ./build/test_my_feature
   ```

---

## æ€»ç»“

ModernFS çš„æµ‹è¯•å¥—ä»¶æä¾›äº†å…¨é¢çš„è¦†ç›–ï¼Œç¡®ä¿ï¼š
- âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… Rust å’Œ C ç»„ä»¶æ­£ç¡®é›†æˆ
- âœ… å¼‚å¸¸æƒ…å†µå¾—åˆ°å¦¥å–„å¤„ç†
- âœ… ç³»ç»Ÿåœ¨é«˜è´Ÿè½½ä¸‹ä¿æŒç¨³å®š
- âœ… å´©æºƒåå¯ä»¥æ­£ç¡®æ¢å¤

è¿è¡Œæ‰€æœ‰æµ‹è¯•åªéœ€ä¸€æ¡å‘½ä»¤ï¼š
```bash
./run_full_test_suite.sh
```

**é¢„æœŸç»“æœ**ï¼š10/10 æµ‹è¯•é€šè¿‡ + Cargo æµ‹è¯•é€šè¿‡ = å®Œå…¨è¦†ç›– âœ…
