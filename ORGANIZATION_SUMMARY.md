# é¡¹ç›®æ•´ç†æ€»ç»“

**æ—¥æœŸ**: 2025-10-07
**çŠ¶æ€**: âœ… æ•´ç†å®Œæˆ

## æ•´ç†å†…å®¹

### âœ… 1. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- åˆ é™¤æ ¹ç›®å½•çš„ `test_week8.img` æµ‹è¯•é•œåƒ
- æ¸…ç†äº†æ‰€æœ‰ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶

### âœ… 2. é‡ç»„æµ‹è¯•æ–‡ä»¶
**ä¹‹å‰**: æµ‹è¯•æ–‡ä»¶æ•£è½åœ¨ `src/` å’Œæ ¹ç›®å½•
```
src/test_ffi.c
src/test_block_layer.c
src/test_inode_layer.c
...
test.bat
test_week8.sh
```

**ä¹‹å**: æŒ‰ç±»å‹ç»„ç»‡åˆ° `tests/` ç›®å½•
```
tests/
â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯•æºæ–‡ä»¶
â”‚   â”œâ”€â”€ test_ffi.c
â”‚   â”œâ”€â”€ test_block_layer.c
â”‚   â”œâ”€â”€ test_inode_layer.c
â”‚   â”œâ”€â”€ test_dir_simple.c
â”‚   â”œâ”€â”€ test_file_write.c
â”‚   â”œâ”€â”€ test_readdir.c
â”‚   â”œâ”€â”€ test_journal.c
â”‚   â”œâ”€â”€ test_extent.c
â”‚   â”œâ”€â”€ test_dump_sb.c
â”‚   â””â”€â”€ test_week7_integration.c
â”‚
â””â”€â”€ scripts/                 # æµ‹è¯•è„šæœ¬
    â”œâ”€â”€ test_week8.sh        # Week 8 é›†æˆæµ‹è¯•
    â”œâ”€â”€ test.bat             # Windows æµ‹è¯•
    â”œâ”€â”€ test_fuse.sh         # FUSE æµ‹è¯•
    â”œâ”€â”€ test_fuse_auto.sh
    â”œâ”€â”€ test_fuse_simple.sh
    â”œâ”€â”€ test_write.sh
    â””â”€â”€ test_write_debug.sh
```

### âœ… 3. æ›´æ–°æ„å»ºé…ç½®
- æ›´æ–° `CMakeLists.txt` ä¸­æ‰€æœ‰æµ‹è¯•æ–‡ä»¶è·¯å¾„
- ä» `src/test_*.c` æ”¹ä¸º `tests/unit/test_*.c`
- æ„å»ºç³»ç»Ÿä¿æŒå…¼å®¹

### âœ… 4. åˆ›å»ºæ¸…ç†è„šæœ¬

#### Linux/macOS: `clean.sh`
```bash
./clean.sh              # æ¸…ç†æ‰€æœ‰ç”Ÿæˆæ–‡ä»¶
./clean.sh --no-rust    # ä¿ç•™ Rust æ„å»º
./clean.sh --no-images  # ä¿ç•™é•œåƒæ–‡ä»¶
./clean.sh --help       # æŸ¥çœ‹å¸®åŠ©
```

åŠŸèƒ½ï¼š
- æ¸…ç† C æ„å»ºæ–‡ä»¶ (`build/`)
- æ¸…ç† Rust æ„å»ºæ–‡ä»¶ (`target/debug/`, `target/incremental/`)
- æ¸…ç†æµ‹è¯•ç”Ÿæˆæ–‡ä»¶
- æ¸…ç†ç£ç›˜é•œåƒ (`*.img`)
- æ¸…ç†ä¸´æ—¶æ–‡ä»¶

#### Windows: `clean.bat`
```cmd
clean.bat               # ä¸€é”®æ¸…ç†ï¼ˆå¸¦ç¡®è®¤ï¼‰
```

### âœ… 5. åˆ›å»ºé¡¹ç›®ç»“æ„æ–‡æ¡£
- `PROJECT_STRUCTURE.md` - å®Œæ•´çš„é¡¹ç›®ç»„ç»‡è¯´æ˜
- åŒ…å«ç›®å½•æ ‘ã€æ–‡ä»¶åˆ†ç±»ã€å‘½åè§„èŒƒ
- åŒ…å«æ„å»ºã€æµ‹è¯•ã€Git ç®¡ç†æŒ‡å—

## æ•´ç†åçš„æ ¹ç›®å½•

ç°åœ¨æ ¹ç›®å½•åªåŒ…å«å¿…è¦çš„é…ç½®å’Œæ–‡æ¡£æ–‡ä»¶ï¼š

```
modernfs/
â”œâ”€â”€ ğŸ“„ é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ Cargo.toml           # Rust workspace
â”‚   â”œâ”€â”€ CMakeLists.txt       # C é¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ .gitignore           # Git å¿½ç•¥è§„åˆ™
â”‚
â”œâ”€â”€ ğŸ“„ æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md            # é¡¹ç›®è¯´æ˜ï¼ˆä¸»æ–‡æ¡£ï¼‰
â”‚   â”œâ”€â”€ CLAUDE.md            # Claude Code æŒ‡å—
â”‚   â”œâ”€â”€ AGENTS.md            # Agent ä½¿ç”¨è¯´æ˜
â”‚   â”œâ”€â”€ PROJECT_STRUCTURE.md # é¡¹ç›®ç»“æ„è¯´æ˜
â”‚   â””â”€â”€ ORGANIZATION_SUMMARY.md  # æœ¬æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“„ æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ build.sh             # Linux/macOS æ„å»º
â”‚   â”œâ”€â”€ build.bat            # Windows æ„å»º
â”‚   â”œâ”€â”€ clean.sh             # Linux/macOS æ¸…ç†
â”‚   â”œâ”€â”€ clean.bat            # Windows æ¸…ç†
â”‚   â””â”€â”€ check_env.bat        # Windows ç¯å¢ƒæ£€æŸ¥
â”‚
â”œâ”€â”€ ğŸ“ æºä»£ç 
â”‚   â”œâ”€â”€ src/                 # C æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ include/             # C å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ rust_core/           # Rust æ ¸å¿ƒåº“
â”‚   â””â”€â”€ tools/               # Rust å·¥å…·é›†
â”‚
â”œâ”€â”€ ğŸ“ æµ‹è¯•
â”‚   â””â”€â”€ tests/
â”‚       â”œâ”€â”€ unit/            # å•å…ƒæµ‹è¯•
â”‚       â””â”€â”€ scripts/         # æµ‹è¯•è„šæœ¬
â”‚
â””â”€â”€ ğŸ“ æ–‡æ¡£
    â””â”€â”€ docs/                # å‘¨æŠ¥å‘Šå’Œè®¡åˆ’æ–‡æ¡£
```

## æ–‡ä»¶ç»Ÿè®¡

### æ ¹ç›®å½•æ–‡ä»¶æ•°é‡
- **æ•´ç†å‰**: çº¦ 15-20 ä¸ªæ–‡ä»¶ï¼ˆåŒ…æ‹¬ä¸´æ—¶æ–‡ä»¶ï¼‰
- **æ•´ç†å**: 13 ä¸ªæ ¸å¿ƒæ–‡ä»¶

### ä»£ç ç»„ç»‡
```
æ€»è®¡: ~6300 è¡Œä»£ç 
â”œâ”€â”€ C ä»£ç : ~3500 è¡Œ
â”‚   â”œâ”€â”€ src/: æ ¸å¿ƒå®ç°
â”‚   â””â”€â”€ tests/unit/: æµ‹è¯•ä»£ç 
â”‚
â””â”€â”€ Rust ä»£ç : ~2800 è¡Œ
    â”œâ”€â”€ rust_core/: æ ¸å¿ƒåº“
    â””â”€â”€ tools/: å·¥å…·é›†
```

### æ–‡æ¡£æ•°é‡
- å‘¨æŠ¥å‘Š: 8 ç¯‡ï¼ˆWeek 1-8ï¼‰
- æŒ‡å—æ–‡æ¡£: 5 ç¯‡
- æ€»æ–‡æ¡£é‡: ~5000 è¡Œ

## Git çŠ¶æ€

### éœ€è¦æäº¤çš„æ›´æ”¹
```bash
modified:   CMakeLists.txt                    # æ›´æ–°æµ‹è¯•è·¯å¾„
new file:   clean.sh                          # æ¸…ç†è„šæœ¬
new file:   clean.bat                         # Windows æ¸…ç†è„šæœ¬
new file:   PROJECT_STRUCTURE.md             # é¡¹ç›®ç»“æ„æ–‡æ¡£
new file:   ORGANIZATION_SUMMARY.md          # æœ¬æ–‡ä»¶

renamed:    src/test_*.c â†’ tests/unit/test_*.c     # æ‰€æœ‰æµ‹è¯•æ–‡ä»¶
renamed:    test.bat â†’ tests/scripts/test.bat
renamed:    test_week8.sh â†’ tests/scripts/test_week8.sh

deleted:    test_week8.img                   # ä¸´æ—¶æ–‡ä»¶
```

### æäº¤å»ºè®®
```bash
# æŸ¥çœ‹æ‰€æœ‰æ›´æ”¹
git status

# æ·»åŠ æ–°æ–‡ä»¶å’Œä¿®æ”¹
git add CMakeLists.txt
git add clean.sh clean.bat
git add PROJECT_STRUCTURE.md ORGANIZATION_SUMMARY.md
git add tests/

# æäº¤
git commit -m "é¡¹ç›®æ•´ç†: é‡ç»„æµ‹è¯•æ–‡ä»¶ï¼Œæ·»åŠ æ¸…ç†è„šæœ¬å’Œæ–‡æ¡£

- å°†æ‰€æœ‰æµ‹è¯•æºæ–‡ä»¶ç§»åŠ¨åˆ° tests/unit/
- å°†æµ‹è¯•è„šæœ¬ç§»åŠ¨åˆ° tests/scripts/
- æ›´æ–° CMakeLists.txt è·¯å¾„
- æ·»åŠ  clean.sh å’Œ clean.bat æ¸…ç†è„šæœ¬
- æ·»åŠ  PROJECT_STRUCTURE.md é¡¹ç›®ç»“æ„æ–‡æ¡£
- æ¸…ç†ä¸´æ—¶æ–‡ä»¶
"
```

## ä½¿ç”¨æŒ‡å—

### æ—¥å¸¸å¼€å‘
```bash
# 1. ä¿®æ”¹ä»£ç 
vim src/some_module.c

# 2. æ„å»º
./build.sh                # æˆ– build.bat

# 3. è¿è¡Œæµ‹è¯•
./build/test_module

# 4. æ¸…ç†ï¼ˆå¦‚éœ€è¦ï¼‰
./clean.sh
```

### æ·»åŠ æ–°æµ‹è¯•
```bash
# 1. åœ¨ tests/unit/ åˆ›å»ºæµ‹è¯•æ–‡ä»¶
vim tests/unit/test_new_feature.c

# 2. åœ¨ CMakeLists.txt æ·»åŠ ç¼–è¯‘è§„åˆ™
# add_executable(test_new_feature tests/unit/test_new_feature.c ...)

# 3. é‡æ–°æ„å»º
rm -rf build && ./build.sh

# 4. è¿è¡Œæµ‹è¯•
./build/test_new_feature
```

### è¿è¡Œå®Œæ•´æµ‹è¯•
```bash
# Week 8 é›†æˆæµ‹è¯•
wsl bash -c "cd /mnt/e/.../NanoFS && ./tests/scripts/test_week8.sh"

# æˆ–ä½¿ç”¨å¿«æ·æ–¹å¼ï¼ˆå¦‚æœåœ¨ Linux/WSLï¼‰
./tests/scripts/test_week8.sh
```

## æ•´ç†æ•ˆæœ

### âœ… ä¼˜ç‚¹
1. **æ¸…æ™°çš„ç›®å½•ç»“æ„**: æ¯ç§æ–‡ä»¶éƒ½æœ‰æ˜ç¡®çš„ä½ç½®
2. **æ˜“äºç»´æŠ¤**: æµ‹è¯•ä»£ç ç‹¬ç«‹ï¼Œä¸ä¸æ ¸å¿ƒä»£ç æ··æ·†
3. **ä¾¿äºæŸ¥æ‰¾**: éµå¾ªæ ‡å‡†é¡¹ç›®å¸ƒå±€
4. **å‡å°‘æ··ä¹±**: æ ¹ç›®å½•æ–‡ä»¶æ•°é‡å¤§å¹…å‡å°‘
5. **å®Œæ•´æ–‡æ¡£**: æ–°å¢è¯¦ç»†çš„ç»„ç»‡è¯´æ˜

### ğŸ“ æ³¨æ„äº‹é¡¹
1. **CMakeLists.txt** å·²æ›´æ–°ï¼Œæ—§çš„ç¼–è¯‘ç¼“å­˜éœ€è¦æ¸…ç†
2. æŸäº› IDE å¯èƒ½éœ€è¦é‡æ–°åŠ è½½é¡¹ç›®
3. å¦‚æœ‰è‡ªå®šä¹‰è„šæœ¬å¼•ç”¨ `src/test_*.c`ï¼Œéœ€è¦æ›´æ–°è·¯å¾„

## éªŒè¯æ­¥éª¤

### 1. éªŒè¯æ„å»º
```bash
# æ¸…ç†æ—§æ„å»º
rm -rf build

# é‡æ–°æ„å»º
./build.sh

# æ£€æŸ¥æ˜¯å¦æˆåŠŸç”Ÿæˆæ‰€æœ‰æµ‹è¯•
ls build/test_*
```

### 2. éªŒè¯æµ‹è¯•è¿è¡Œ
```bash
# è¿è¡Œä¸€ä¸ªç®€å•æµ‹è¯•
./build/test_ffi

# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
./tests/scripts/test_week8.sh
```

### 3. éªŒè¯æ¸…ç†è„šæœ¬
```bash
# è¿è¡Œæ¸…ç†
./clean.sh

# æ£€æŸ¥æ˜¯å¦æ¸…ç†å¹²å‡€
ls build/ target/debug/ *.img
```

## ä¸‹ä¸€æ­¥å»ºè®®

### å¯é€‰æ”¹è¿›
1. æ·»åŠ  `Makefile` ä½œä¸º CMake çš„ç®€åŒ–å…¥å£
2. åˆ›å»º `docs/BUILD.md` è¯¦ç»†æ„å»ºæŒ‡å—
3. æ·»åŠ  `.editorconfig` ç»Ÿä¸€ä»£ç é£æ ¼
4. åˆ›å»º GitHub Actions CI é…ç½®

### ç»´æŠ¤å»ºè®®
1. å®šæœŸè¿è¡Œ `./clean.sh` æ¸…ç†ç”Ÿæˆæ–‡ä»¶
2. æäº¤å‰æ£€æŸ¥ `git status`ï¼Œé¿å…æäº¤ä¸´æ—¶æ–‡ä»¶
3. ä¿æŒ `tests/` ç›®å½•ç»„ç»‡æ¸…æ™°
4. æ›´æ–°æ–‡æ¡£åæ˜ é¡¹ç›®å˜åŒ–

---

**æ•´ç†å®Œæˆæ—¥æœŸ**: 2025-10-07
**æ•´ç†è€…**: Claude Code
**é¡¹ç›®çŠ¶æ€**: âœ… å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥æäº¤
